<div class="resource-planner">
  <h2><%= l(:resource_planner_title) %></h2>

  <div class="resource-planner__summary">
    <h3><%= l(:resource_planner_members_heading) %></h3>
    <% if @users.any? %>
      <ul>
        <% @users.each do |user| %>
          <li><%= link_to user.name, user_path(user) %></li>
        <% end %>
      </ul>
    <% else %>
      <p class="resource-planner__empty"><%= l(:resource_planner_no_members) %></p>
    <% end %>
  </div>

  <div class="resource-planner__unassigned">
    <h3><%= l(:resource_planner_unassigned_heading) %></h3>
    <% if @unassigned_issues.any? %>
      <ul>
        <% @unassigned_issues.each do |issue| %>
          <li>
            <%= link_to "##{issue.id} #{issue.subject}", issue_path(issue) %>
            <% if issue.estimated_hours.present? %>
              <span class="resource-planner__estimate">(<%= issue.estimated_hours %>h)</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="resource-planner__empty"><%= l(:resource_planner_no_unassigned) %></p>
    <% end %>
  </div>

  <div class="resource-planner__grid">
    <table>
      <thead>
        <tr>
          <th><%= l(:label_user) %></th>
          <% @weeks.each do |week_start| %>
            <th>
              <div class="week-label">
                <span class="week-range">
                  <%= l(:label_week) %> <%= week_start.cweek %>
                </span>
                <span class="week-dates">
                  <%= week_start.strftime('%b %d') %> - <%= (week_start + 6).strftime('%b %d') %>
                </span>
              </div>
            </th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% if @resource_rows.any? %>
          <% @resource_rows.each do |row| %>
            <tr>
              <th scope="row"><%= link_to row[:user].name, user_path(row[:user]) %></th>
              <% row[:cells].each do |cell| %>
                <% hours = cell[:hours] %>
                <td class="resource-cell <%= resource_load_class(hours) %>">
                  <span class="hours"><%= format('%.1f', hours) %>h</span>
                  <% if cell[:issue_count].positive? %>
                    <span class="issues"><%= cell[:issue_count] %> <%= l(:label_issue_plural) %></span>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="<%= @weeks.size + 1 %>" class="resource-planner__empty">
              <%= l(:resource_planner_no_assignments) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <p class="resource-planner__placeholder">
    <%= l(:resource_planner_placeholder) %>
  </p>
</div>

